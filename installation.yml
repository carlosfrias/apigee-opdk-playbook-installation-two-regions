---
- include: configuration/update_cache.yml
  tags:
  - cache
  - os-pre-req
  - apigee-pre-req
  - dc1
  - dc2
  - apigee-logs
  - logs
  - os-logs
  - ds

- include: configuration/load-opdk-credentials.yml
  vars:
    hosts: 'planet'
  tags:
  - credentials
  - os-pre-req
  - apigee-pre-req
  - dc1
  - dc2
  - dc1-validation
  - dc2-validation
  - apigee-logs
  - logs
  - os-logs
  - ds

- include: configuration/opdk-setup-os.yml
  vars:
    hosts: 'planet'
  tags:
  - os
  - os-pre-req
  - dc1
  - dc2
  - ds

- include: configuration/update-user.yml
  vars:
    hosts: 'planet'
    user: 'root'
  tags:
  - root-user
  - dc1
  - dc2
  - ds

# Region 1
- include: components/opdk-pre-requisites.yml
  vars:
    hosts: 'dc1'
    jdk_version: '1.8'
  tags:
  - apigee-pre-req
  - dc1
  - ds

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-ds'
    component_profile: 'ds'
  tags:
  - dc1-ds
  - dc1
  - ds

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-ms'
    component_profile: 'ms'
  tags:
  - dc1-ms
  - dc1

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-rmp'
    component_profile: 'rmp'
  tags:
  - dc1-rmp
  - dc1

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-qpid'
    component_profile: 'qs'
  tags:
  - dc1-qpid
  - dc1

- include: components/opdk-setup-postgres-common.yml
  vars:
    hosts: 'dc1-pgmaster'
    pg_component: 'master'
  tags:
  - dc1-pgmaster
  - dc1
  - dc1-pg

- include: components/opdk-setup-postgres-common.yml
  vars:
    hosts: 'dc1-pgstandby'
    pg_component: 'standby'
  tags:
  - dc1-pgstandby
  - dc1
  - dc1-pg

- include: configuration/opdk-setup-org-config.yml
  vars:
    hosts: 'dc1-ms'
  tags:
  - dc1-org
  - dc1

- include: configuration/opdk-setup-org.yml
  vars:
    hosts: 'dc1-ms'
  tags:
  - dc1-org
  - dc1

- include: validations/opdk-setup-validate.yml
  vars:
    hosts: 'dc1-rmp'
  tags:
  - dc1-validation
  - dc1

# Region 2
- include: components/opdk-pre-requisites.yml
  vars:
    hosts: 'planet'
    jdk_version: '1.8'
    opdk_ldap_type: '2'
  tags:
  - apigee-pre-req
  - dc2
  - ds

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc2-ds'
    component_profile: 'ds'
    jdk_version: '1.8'
  tags:
  - dc2-ds
  - dc2
  - ds

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-ds'
    component_profile: 'ds'
    jdk_version: '1.8'
  tags:
  - dc2-ds
  - dc2
  - ds

- include: components/opdk-cassandra-client-update.yml
  vars:
     hosts: 'dc1-ms'
     jdk_version: '1.8'
  tags:
  - dc2-ms
  - dc2
  - ds

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-ms'
    component_profile: 'ms'
    jdk_version: '1.8'
  tags:
  - dc2-ms
  - dc2

- include: components/opdk-cassandra-rebuild.yml
  vars:
    hosts: 'dc2-ds'
    jdk_version: '1.8'
  tags:
  - dc2-ms
  - dc2
  - ds

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc2-ms'
    component_profile: 'ms'
    jdk_version: '1.8'
  tags:
  - dc2-ms
  - dc2

- include: configuration/opdk-set-reachable.yml
  vars:
    hosts: 'dc2-rmp'
    reachability: 'false'
  tags:
  - dc2-rmp
  - dc2

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc2-rmp'
    component_profile: 'rmp'
    jdk_version: '1.8'
  tags:
  - dc2-rmp
  - dc2

- include: configuration/opdk-set-reachable.yml
  vars:
    hosts: 'dc2-rmp'
    reachability: 'true'
  tags:
  - dc2-rmp
  - dc2

- include: configuration/opdk-set-reachable.yml
  vars:
    hosts: 'dc1-rmp'
    reachability: 'false'
  tags:
  - dc2-rmp
  - dc2

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc1-rmp'
    component_profile: 'rmp'
    jdk_version: '1.8'
  tags:
  - dc2-rmp
  - dc2

- include: configuration/opdk-set-reachable.yml
  vars:
    hosts: 'dc1-rmp'
    reachability: 'true'
  tags:
  - dc2-rmp
  - dc2

- include: components/opdk-install-component.yml
  vars:
    hosts: 'dc2-qpid'
    component_profile: 'qs'
    jdk_version: '1.8'
  tags:
  - dc2-qpid
  - dc2

- include: components/opdk-setup-qpid-add.yml
  vars:
    hosts: 'dc2-qpid'
  tags:
  - dc2-qpid
  - dc2

#  TODO: add new ax group here then continue

- include: components/opdk-setup-postgres-common.yml
  vars:
    hosts: 'dc2-pgmaster'
    pg_component: 'master'
    jdk_version: '1.8'
  tags:
  - dc2-pgmaster
  - dc2
  - dc2-pg

- include: components/opdk-setup-postgres-common.yml
  vars:
    hosts: 'dc2-pgstandby'
    pg_component: 'standby'
    jdk_version: '1.8'
  tags:
  - dc2-pgstandby
  - dc2
  - dc2-pg

- include: components/opdk-setup-postgresql-add.yml
  vars:
    hosts: 'dc2-standby'
  tags:
  - dc2-pgstandby
  - dc2
  - dc2-pg

- include: configuration/opdk-setup-org-config.yml
  vars:
    hosts: 'dc2-ms'
  tags:
  - dc2-org
  - dc2

- include: configuration/opdk-setup-org.yml
  vars:
    hosts: 'dc2-ms'
  tags:
  - dc2-org
  - dc2

- include: validations/opdk-setup-validate.yml
  vars:
    hosts: 'dc2-rmp'
  tags:
  - dc2-validation
  - dc2

- include: validations/opdk-internal-port-connectivity-validator.yml
  tags:
  - port-validator

- include: validations/opdk-setup-status.yml
  vars:
    hosts: 'planet'
  tags:
  - status
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc1-ds
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc2-ds
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc1-ms
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc2-ms
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc1-rmp
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc2-rmp
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc1-qpid
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc2-qpid
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc1-pgmaster
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc2-pgmaster
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc1-pgstandby
  tags:
  - logs
  - dc1
  - dc2

- include: validations/opdk-setup-log-files.yml
  vars:
    hosts: dc2-pgstandby
  tags:
  - logs
  - dc1
  - dc2

